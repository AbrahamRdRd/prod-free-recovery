import{a as q}from"./axios-CwoVb0Lo.js";import{i as ae}from"./ionicons-vuVtR0Xh.js";import{u as te,C as ne,B as oe,A as se,v as m,K as F,e as X,O as j,x as z,N as H,l as L,k as r,t as I,E as N,d as le,r as ue,P as ie}from"./@ionic-BYXd9M1L.js";import{u as de}from"./vue-router-C1vmwl4t.js";import{u as re}from"./index-CWE9Jaid.js";import{d as ce,r as c,c as b,aG as pe,w as ve,aM as p,a1 as me,aa as t,by as a,be as e,a9 as d,b7 as f,$ as v,a0 as k,a2 as w,H as fe,aP as _e,aN as ge}from"./@vue-yfti66JX.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const S=h=>(_e("data-v-53e10cf6"),h=h(),ge(),h),he=S(()=>w("h2",null,"Detalle de precio",-1)),ye=S(()=>w("u",null,"Tarifia de servicio",-1)),De=S(()=>w("b",null,"Total(MXN)",-1)),Ce=ce({__name:"ReservationCard",props:{departmentInfo:Object},setup(h){const x=de(),U=te(),_=c(0),u=c(),$=c(!0),g=c(!1),B=b(()=>D.departmentInfo),T=b(()=>D.reservation),M=c({date:{weekday:"short",month:"long",day:"2-digit"},time:{hour:"2-digit",minute:"2-digit"}}),K=o=>{const n=new Date(o).getUTCDay();return n!==0&&n!==6},l=c({date_in:new Date().toISOString().split("T")[0],date_out:new Date(new Date().setDate(new Date().getDate()+1)).toISOString().split("T")[0]}),O=h,A=c(""),y=c(),i=c(),D=re(),R=b(()=>D.isLogged),G=b(()=>D.reservation),V=(o,s)=>{const n=new Date(o),C=new Date(s),ee=Math.abs(C.getTime()-n.getTime());if(C>n)$.value=!0,g.value=!1;else return Math.ceil(ee/(1e3*60*60*24))},Y=o=>{R.value?W(o):U.push("/login")},W=async o=>{var s;try{const n=await q.post("https://api.stripe.com/v1/checkout/sessions",{success_url:"recovery-suites.com/departments/".concat(x.params.id,"/succes-payment?department=").concat((s=i.value)==null?void 0:s.name,"&date_in=").concat(l.value.date_in,"&date_out=").concat(l.value.date_out,"&total=").concat(y.value),cancel_url:"recovery-suites.com/departments/".concat(x.params.id),line_items:[{price:o,quantity:u.value}],mode:"payment",payment_method_types:["card"]},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});D.setCheckOutId(n.data.id),n.data.url&&(window.location.href=n.data.url)}catch(n){console.error("Error en el checkout",n)}},E=async o=>{try{const s=await q.post("https://api.stripe.com/v1/prices",{currency:"mxn",unit_amount:o*100,"product_data[name]":"Gold Plan"},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});A.value=s.data.id}catch(s){console.error("No pudimos agregar el precio",s)}},P=()=>{if(i.value=B.value,l.value.date_out=T.value.date_out,l.value.date_in=T.value.date_in,_.value=i.value.price,u.value=V(l.value.date_out,l.value.date_in),console.log("Total",u.value),u.value){y.value=_.value*u.value*1.1;const o=_.value*1.1;E(parseInt(o.toFixed(2)))}},J=async()=>{if(O.departmentInfo&&(i.value=O.departmentInfo,_.value=O.departmentInfo.price,u.value=V(l.value.date_out,l.value.date_in),u.value)){y.value=_.value*u.value*1.1;const o=_.value*1.1;E(parseInt(o.toFixed(2)))}};R.value&&G!=null;const Q=o=>{var s;l.value.date_out=(s=o.detail.value)!=null?s:"",console.log("handdle",l.value.date_out)},Z=o=>{var s;l.value.date_in=(s=o.detail.value)!=null?s:"",console.log("handdle",l.value.date_in)};return pe(()=>{x.fullPath.includes("reservation")&&x.query.department?P():J()}),ve(()=>[B.value,T.value],o=>{P(),console.log("El valor de date_out ha cambiado a:",o)}),(o,s)=>(p(),me(fe,null,[t(e(ue),{class:"ion-padding-vertical w-full card-content"},{default:a(()=>[t(e(ne),null,{default:a(()=>[t(e(oe),{class:"ml-3"},{default:a(()=>{var n;return[d(f((n=i.value)==null?void 0:n.name),1)]}),_:1}),t(e(se),{class:"ml-3"},{default:a(()=>{var n;return[d("$"+f((n=i.value)==null?void 0:n.price)+" MXN p/noche",1)]}),_:1}),t(e(m)),t(e(F),{class:"p-0"},{default:a(()=>[t(e(m),null,{default:a(()=>[t(e(X),null,{default:a(()=>[d("Día de entrada")]),_:1}),t(e(j),{datetime:"datetimeIn"}),t(e(z),{"keep-contents-mounted":!0},{default:a(()=>[t(e(H),{id:"datetimeIn","is-date-enabled":K,presentation:"date",value:l.value.date_in,"format-options":M.value,onIonChange:Z},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1}),t(e(F),{class:"p-0"},{default:a(()=>[t(e(m),{lines:"inset"},{default:a(()=>[t(e(X),null,{default:a(()=>[d("Día de Salida")]),_:1}),t(e(j),{datetime:"datetimeOut"}),t(e(z),{"keep-contents-mounted":!0},{default:a(()=>[t(e(H),{id:"datetimeOut",presentation:"date",value:l.value.date_out,"format-options":M.value,onIonChange:Q},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1})]),_:1}),g.value?k("",!0):(p(),v(e(L),{key:0,onClick:s[0]||(s[0]=n=>Y(A.value)),class:"mx-5",expand:"block"},{default:a(()=>[d(" Reservar ")]),_:1})),g.value?(p(),v(e(L),{key:1,disabled:"",expand:"block",class:"ion-margin"},{default:a(()=>[d(" Revisa las fechas ")]),_:1})):k("",!0),t(e(m),{lines:"inset"},{default:a(()=>[t(e(r),{class:"ion-padding-start"},{default:a(()=>[he]),_:1})]),_:1}),t(e(m),{lines:"inset"},{default:a(()=>[t(e(I),{size:"6"},{default:a(()=>[t(e(r),{class:"ion-padding-start ion-no-margin text-base"},{default:a(()=>{var n;return[w("u",null,"$"+f((n=i.value)==null?void 0:n.price)+" MXN x "+f(u.value)+" noches",1)]}),_:1})]),_:1}),t(e(I),{size:"6"},{default:a(()=>[t(e(N),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>{var n;return[(n=i.value)!=null&&n.price&&u.value?(p(),v(e(r),{key:0,class:"ion-no-margin text-base"},{default:a(()=>{var C;return[d("$"+f(((C=i.value)==null?void 0:C.price)*u.value)+" MXN",1)]}),_:1})):g.value?k("",!0):(p(),v(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]}),_:1})]),_:1})]),_:1}),t(e(m),{lines:"inset"},{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(r),{class:"ion-padding-start ion-no-margin text-lg"},{default:a(()=>[ye,t(e(le),{icon:e(ae)},null,8,["icon"])]),_:1})]),_:1}),t(e(I),null,{default:a(()=>[t(e(N),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>[i.value&&u.value?(p(),v(e(r),{key:0,class:"ion-no-margin text-base"},{default:a(()=>[d("$"+f(i.value.price*u.value*.1)+" MXN",1)]),_:1})):g.value?k("",!0):(p(),v(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]),_:1})]),_:1})]),_:1}),t(e(m),{lines:"inset"},{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(r),{class:"ion-padding-start"},{default:a(()=>[De]),_:1})]),_:1}),t(e(I),null,{default:a(()=>[t(e(N),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>[y.value?(p(),v(e(r),{key:0,class:"ion-padding-start text-base"},{default:a(()=>[w("b",null,"$"+f(y.value.toFixed(2)),1)]),_:1})):g.value?k("",!0):(p(),v(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ie),{"is-open":$.value,position:"middle",message:"Agrega los días que quieres quedarte","position-anchor":"footer",duration:2e3,onDidDismiss:s[1]||(s[1]=n=>$.value=!1)},null,8,["is-open"])],64))}}),Ne=Ie(Ce,[["__scopeId","data-v-53e10cf6"]]);export{Ne as R};
