import{a as j}from"./axios-CwoVb0Lo.js";import{d as ae,O as te,f as ne,r as c,a as b,u as oe,ah as se,N as le,o as p,c as ue,g as t,w as a,e,E as ie,D as de,t as d,C as m,B as re,X as f,W as q,ac as F,ai as L,aj as z,ag as P,b as v,s as U,T as C,ab as r,J as h,m as w,L as O,R as ce,ak as pe,n as ve,al as me,K as fe,x as _e,y as ge}from"./index-CLBR-bQb.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const S=I=>(_e("data-v-98c60656"),I=I(),ge(),I),Ie=S(()=>w("h2",null,"Detalle de precio",-1)),ye=S(()=>w("u",null,"Tarifia de servicio",-1)),De=S(()=>w("b",null,"Total(MXN)",-1)),ke=ae({__name:"ReservationCard",props:{departmentInfo:Object},setup(I){const x=te(),H=ne(),_=c(0),l=c(),T=c(!0),g=c(!1),B=b(()=>D.departmentInfo),K=b(()=>D.reservation),N=c({date:{weekday:"short",month:"long",day:"2-digit"},time:{hour:"2-digit",minute:"2-digit"}}),W=o=>{const n=new Date(o).getUTCDay();return n!==0&&n!==6},u=c({date_in:new Date().toISOString().split("T")[0],date_out:new Date(new Date().setDate(new Date().getDate()+1)).toISOString().split("T")[0]}),$=I,M=c(""),y=c(),i=c(),D=oe(),R=b(()=>D.isLogged),Y=b(()=>D.reservation),G=o=>{var s;u.value.date_out=(s=o.detail.value)!=null?s:"",console.log(o.detail.value)},J=o=>{var s;u.value.date_in=(s=o.detail.value)!=null?s:""},A=(o,s)=>{const n=new Date(o),k=new Date(s),ee=Math.abs(k.getTime()-n.getTime());if(k>n)T.value=!0,g.value=!1;else return Math.ceil(ee/(1e3*60*60*24))},Q=o=>{R.value?Z(o):H.push("/login")},Z=async o=>{var s;try{const n=await j.post("https://api.stripe.com/v1/checkout/sessions",{success_url:"http://localhost:5173/departments/".concat(x.params.id,"/succes-payment?department=").concat((s=i.value)==null?void 0:s.name,"&date_in=").concat(u.value.date_in,"&date_out=").concat(u.value.date_out,"&total=").concat(y.value),cancel_url:"http://localhost:5173/departments/".concat(x.params.id),line_items:[{price:o,quantity:l.value}],mode:"payment",payment_method_types:["card"]},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});console.log("url_check",n.data.url),D.setCheckOutId(n.data.id),n.data.url&&(window.location.href=n.data.url)}catch(n){console.error("Error en el checkout",n)}},V=async o=>{try{const s=await j.post("https://api.stripe.com/v1/prices",{currency:"mxn",unit_amount:o*100,"product_data[name]":"Gold Plan"},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});M.value=s.data.id}catch(s){console.error("No pudimos agregar el precio",s)}},E=()=>{if(i.value=B.value,_.value=i.value.price,l.value=A(u.value.date_out,u.value.date_in),l.value){y.value=_.value*l.value*1.1;const o=_.value*1.1;V(parseInt(o.toFixed(2)))}},X=async()=>{if($.departmentInfo&&(i.value=$.departmentInfo,_.value=$.departmentInfo.price,l.value=A(u.value.date_out,u.value.date_in),l.value)){y.value=_.value*l.value*1.1;const o=_.value*1.1;V(parseInt(o.toFixed(2)))}};return R.value&&Y!=null,se(()=>{x.fullPath.includes("reservation")&&x.query.department?E():X()}),le(()=>[B.value,K.value,u.value.date_in,u.value.date_out],o=>{X(),E(),console.log("El valor de date_out ha cambiado a:",o)}),(o,s)=>(p(),ue(fe,null,[t(e(ve),{class:"ion-padding-vertical w-full card-content"},{default:a(()=>[t(e(ie),null,{default:a(()=>[t(e(de),{class:"ml-3"},{default:a(()=>{var n;return[d(m((n=i.value)==null?void 0:n.name),1)]}),_:1}),t(e(re),{class:"ml-3"},{default:a(()=>{var n;return[d("$"+m((n=i.value)==null?void 0:n.price)+" MXN p/noche",1)]}),_:1}),t(e(f)),t(e(q),{class:"p-0"},{default:a(()=>[t(e(f),null,{default:a(()=>[t(e(F),null,{default:a(()=>[d("Día de entrada")]),_:1}),t(e(L),{datetime:"datetimeIn"}),t(e(z),{"keep-contents-mounted":!0},{default:a(()=>[t(e(P),{id:"datetimeIn","is-date-enabled":W,presentation:"date",value:u.value.date_in,"format-options":N.value,onIonChange:J},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1}),t(e(q),{class:"p-0"},{default:a(()=>[t(e(f),{lines:"inset"},{default:a(()=>[t(e(F),null,{default:a(()=>[d("Día de Salida")]),_:1}),t(e(L),{datetime:"datetimeOut"}),t(e(z),{"keep-contents-mounted":!0},{default:a(()=>[t(e(P),{id:"datetimeOut",presentation:"date",value:u.value.date_out,"format-options":N.value,onIonChange:G},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1})]),_:1}),g.value?C("",!0):(p(),v(e(U),{key:0,onClick:s[0]||(s[0]=n=>Q(M.value)),class:"mx-5",expand:"block"},{default:a(()=>[d(" Reservar ")]),_:1})),g.value?(p(),v(e(U),{key:1,disabled:"",expand:"block",class:"ion-margin"},{default:a(()=>[d(" Revisa las fechas ")]),_:1})):C("",!0),t(e(f),{lines:"inset"},{default:a(()=>[t(e(r),{class:"ion-padding-start"},{default:a(()=>[Ie]),_:1})]),_:1}),t(e(f),{lines:"inset"},{default:a(()=>[t(e(h),{size:"6"},{default:a(()=>[t(e(r),{class:"ion-padding-start ion-no-margin text-base"},{default:a(()=>{var n;return[w("u",null,"$"+m((n=i.value)==null?void 0:n.price)+" MXN x "+m(l.value)+" noches",1)]}),_:1})]),_:1}),t(e(h),{size:"6"},{default:a(()=>[t(e(O),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>{var n;return[(n=i.value)!=null&&n.price&&l.value?(p(),v(e(r),{key:0,class:"ion-no-margin text-base"},{default:a(()=>{var k;return[d("$"+m(((k=i.value)==null?void 0:k.price)*l.value)+" MXN",1)]}),_:1})):g.value?C("",!0):(p(),v(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]}),_:1})]),_:1})]),_:1}),t(e(f),{lines:"inset"},{default:a(()=>[t(e(h),null,{default:a(()=>[t(e(r),{class:"ion-padding-start ion-no-margin text-lg"},{default:a(()=>[ye,t(e(ce),{icon:e(pe)},null,8,["icon"])]),_:1})]),_:1}),t(e(h),null,{default:a(()=>[t(e(O),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>[i.value&&l.value?(p(),v(e(r),{key:0,class:"ion-no-margin text-base"},{default:a(()=>[d("$"+m(i.value.price*l.value*.1)+" MXN",1)]),_:1})):g.value?C("",!0):(p(),v(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]),_:1})]),_:1})]),_:1}),t(e(f),{lines:"inset"},{default:a(()=>[t(e(h),null,{default:a(()=>[t(e(r),{class:"ion-padding-start"},{default:a(()=>[De]),_:1})]),_:1}),t(e(h),null,{default:a(()=>[t(e(O),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>[y.value?(p(),v(e(r),{key:0,class:"ion-padding-start text-base"},{default:a(()=>[w("b",null,"$"+m(y.value.toFixed(2)),1)]),_:1})):g.value?C("",!0):(p(),v(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(me),{"is-open":T.value,position:"middle",message:"Agrega los días que quieres quedarte","position-anchor":"footer",duration:2e3,onDidDismiss:s[1]||(s[1]=n=>T.value=!1)},null,8,["is-open"])],64))}}),be=he(ke,[["__scopeId","data-v-98c60656"]]);export{be as R};
