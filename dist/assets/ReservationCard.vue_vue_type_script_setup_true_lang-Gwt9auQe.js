import{a as R}from"./axios-CwoVb0Lo.js";import{d as W,O as Q,f as Z,r as c,a as x,u as ee,N as ae,o as v,c as te,g as t,w as a,e,E as ne,D as le,t as d,C as _,B as oe,W as m,V as E,ac as X,ag as q,ah as F,ae as L,b as p,s as z,X as k,ab as r,J as h,m as C,L as b,R as se,ai as ue,n as ie,af as de,K as re}from"./index-b4t3Mdji.js";const ce=C("h2",null,"Detalle de precio",-1),ve=C("u",null,"Tarifia de servicio",-1),pe=C("b",null,"Total(MXN)",-1),ge=W({__name:"ReservationCard",setup(_e){const w=Q(),P=Z(),f=c(0),u=c(),$=c(!0),g=c(!1),T=x(()=>y.departmentInfo),O=x(()=>y.reservation),N=c({date:{weekday:"short",month:"long",day:"2-digit"}}),s=c({date_in:new Date().toISOString().split("T")[0],date_out:new Date(new Date().setDate(new Date().getDate()+1)).toISOString().split("T")[0]}),B=c(""),I=c(),i=c(),y=ee(),M=x(()=>y.isLogged),j=x(()=>y.reservation),H=l=>{var o;s.value.date_out=(o=l.detail.value)!=null?o:"",console.log(l.detail.value)},K=l=>{var o;s.value.date_in=(o=l.detail.value)!=null?o:""},S=(l,o)=>{const n=new Date(l),D=new Date(o),J=Math.abs(D.getTime()-n.getTime());if(D>n)$.value=!0,g.value=!1;else return Math.ceil(J/(1e3*60*60*24))},U=l=>{M.value?Y(l):P.push("/login")},Y=async l=>{var o;try{const n=await R.post("https://api.stripe.com/v1/checkout/sessions",{success_url:"http://localhost:5173/departments/".concat(w.params.id,"/succes-payment?department=").concat((o=i.value)==null?void 0:o.name,"&date_in=").concat(s.value.date_in,"&date_out=").concat(s.value.date_out,"&total=").concat(I.value),cancel_url:"http://localhost:5173/departments/".concat(w.params.id),line_items:[{price:l,quantity:u.value}],mode:"payment",payment_method_types:["card"]},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});console.log("url_check",n.data.url),y.setCheckOutId(n.data.id),n.data.url&&(window.location.href=n.data.url)}catch(n){console.error("Error en el checkout",n)}},V=async l=>{try{const o=await R.post("https://api.stripe.com/v1/prices",{currency:"mxn",unit_amount:l*100,"product_data[name]":"Gold Plan"},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});B.value=o.data.id}catch(o){console.error("No pudimos agregar el precio",o)}},A=()=>{if(s.value=O.value,i.value=T.value,f.value=i.value.price,u.value=S(s.value.date_out,s.value.date_in),u.value){I.value=f.value*u.value*1.1;const l=f.value*1.1;V(parseInt(l.toFixed(2)))}},G=async()=>{if(i.value=T.value,f.value=i.value.price,u.value=S(s.value.date_out,s.value.date_in),u.value){I.value=f.value*u.value*1.1;const l=f.value*1.1;V(parseInt(l.toFixed(2)))}};return M.value&&j!=null,w.fullPath.includes("reservation")&&w.query.department&&A(),ae(()=>[O.value,s.value.date_in,s.value.date_out],l=>{G(),A(),console.log("El valor de date_out ha cambiado a:",l)}),(l,o)=>(v(),te(re,null,[t(e(ie),{class:"ion-padding-vertical w-9"},{default:a(()=>[t(e(ne),null,{default:a(()=>[t(e(le),null,{default:a(()=>{var n;return[d(_((n=i.value)==null?void 0:n.name),1)]}),_:1}),t(e(oe),null,{default:a(()=>{var n;return[d("$"+_((n=i.value)==null?void 0:n.price)+" MXN p/noche",1)]}),_:1}),t(e(m)),t(e(E),null,{default:a(()=>[t(e(m),null,{default:a(()=>[t(e(X),null,{default:a(()=>[d("Día de entrada")]),_:1}),t(e(q),{datetime:"datetimeIn"}),t(e(F),{"keep-contents-mounted":!0},{default:a(()=>[t(e(L),{id:"datetimeIn",presentation:"date",value:s.value.date_in,"format-options":N.value,onIonChange:K},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1}),t(e(E),null,{default:a(()=>[t(e(m),null,{default:a(()=>[t(e(X),null,{default:a(()=>[d("Día de Salida")]),_:1}),t(e(q),{datetime:"datetimeOut"}),t(e(F),{"keep-contents-mounted":!0},{default:a(()=>[t(e(L),{id:"datetimeOut",presentation:"date",value:s.value.date_out,"format-options":N.value,onIonChange:H},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1})]),_:1}),g.value?k("",!0):(v(),p(e(z),{key:0,onClick:o[0]||(o[0]=n=>U(B.value)),expand:"block",class:"ion-margin"},{default:a(()=>[d(" Reservar ")]),_:1})),g.value?(v(),p(e(z),{key:1,disabled:"",expand:"block",class:"ion-margin"},{default:a(()=>[d(" Revisa las fechas ")]),_:1})):k("",!0),t(e(m),null,{default:a(()=>[t(e(r),{class:"ion-padding-start"},{default:a(()=>[ce]),_:1})]),_:1}),t(e(m),null,{default:a(()=>[t(e(h),{size:"6"},{default:a(()=>[t(e(r),{class:"ion-padding-start ion-no-margin text-base"},{default:a(()=>{var n;return[C("u",null,"$"+_((n=i.value)==null?void 0:n.price)+" MXN x "+_(u.value)+" noches",1)]}),_:1})]),_:1}),t(e(h),{size:"6"},{default:a(()=>[t(e(b),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>{var n;return[(n=i.value)!=null&&n.price&&u.value?(v(),p(e(r),{key:0,class:"ion-no-margin text-base"},{default:a(()=>{var D;return[d("$"+_(((D=i.value)==null?void 0:D.price)*u.value)+" MXN",1)]}),_:1})):g.value?k("",!0):(v(),p(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]}),_:1})]),_:1})]),_:1}),t(e(m),null,{default:a(()=>[t(e(h),null,{default:a(()=>[t(e(r),{class:"ion-padding-start ion-no-margin text-lg"},{default:a(()=>[ve,t(e(se),{icon:e(ue)},null,8,["icon"])]),_:1})]),_:1}),t(e(h),null,{default:a(()=>[t(e(b),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>[i.value&&u.value?(v(),p(e(r),{key:0,class:"ion-no-margin text-base"},{default:a(()=>[d("$"+_(i.value.price*u.value*.1)+" MXN",1)]),_:1})):g.value?k("",!0):(v(),p(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]),_:1})]),_:1})]),_:1}),t(e(m),null,{default:a(()=>[t(e(h),null,{default:a(()=>[t(e(r),{class:"ion-padding-start"},{default:a(()=>[pe]),_:1})]),_:1}),t(e(h),null,{default:a(()=>[t(e(b),{class:"ion-justify-content-end ion-margin-end"},{default:a(()=>[I.value?(v(),p(e(r),{key:0,class:"ion-padding-start text-base"},{default:a(()=>[C("b",null,"$"+_(I.value.toFixed(2)),1)]),_:1})):g.value?k("",!0):(v(),p(e(r),{key:1},{default:a(()=>[d("???")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(de),{"is-open":$.value,position:"middle",message:"Agrega los días que quieres quedarte","position-anchor":"footer",duration:2e3,onDidDismiss:o[1]||(o[1]=n=>$.value=!1)},null,8,["is-open"])],64))}});export{ge as _};
