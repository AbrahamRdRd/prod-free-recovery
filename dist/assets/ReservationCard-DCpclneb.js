import{a as F}from"./axios-CwoVb0Lo.js";import{i as te}from"./ionicons-vuVtR0Xh.js";import{u as ae,z as ne,y as oe,x as se,v as f,H,e as L,M as P,N as X,L as j,l as E,k as d,C as h,B as O,d as le,q as ie,O as ue}from"./@ionic-B3KGByIv.js";import{u as re}from"./vue-router-C1vmwl4t.js";import{u as de}from"./index-BiLyZEfA.js";import{d as ce,r as c,c as b,aG as pe,w as me,aM as p,a1 as fe,aa as a,by as t,be as e,a9 as r,b7 as v,$ as m,a0 as k,a2 as w,H as ve,aP as _e,aN as Ie}from"./@vue-yfti66JX.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M=g=>(_e("data-v-0fc73287"),g=g(),Ie(),g),ge=M(()=>w("h2",null,"Detalle de precio",-1)),ye=M(()=>w("u",null,"Tarifia de servicio",-1)),De=M(()=>w("b",null,"Total(MXN)",-1)),Ce=ce({__name:"ReservationCard",props:{departmentInfo:Object},setup(g){const x=re(),U=ae(),_=c(0),l=c(),$=c(!0),I=c(!1),N=b(()=>D.departmentInfo),G=b(()=>D.reservation),S=c({date:{weekday:"short",month:"long",day:"2-digit"},time:{hour:"2-digit",minute:"2-digit"}}),K=s=>{const n=new Date(s).getUTCDay();return n!==0&&n!==6},i=c({date_in:new Date().toISOString().split("T")[0],date_out:new Date(new Date().setDate(new Date().getDate()+1)).toISOString().split("T")[0]}),T=g,B=c(""),y=c(),u=c(),D=de(),R=b(()=>D.isLogged),Y=b(()=>D.reservation),W=s=>{var o;i.value.date_out=(o=s.detail.value)!=null?o:""},J=s=>{var o;i.value.date_in=(o=s.detail.value)!=null?o:""},V=(s,o)=>{const n=new Date(s),C=new Date(o),ee=Math.abs(C.getTime()-n.getTime());if(C>n)$.value=!0,I.value=!1;else return Math.ceil(ee/(1e3*60*60*24))},Q=s=>{R.value?Z(s):U.push("/login")},Z=async s=>{var o;try{const n=await F.post("https://api.stripe.com/v1/checkout/sessions",{success_url:"http://localhost:5173/departments/".concat(x.params.id,"/succes-payment?department=").concat((o=u.value)==null?void 0:o.name,"&date_in=").concat(i.value.date_in,"&date_out=").concat(i.value.date_out,"&total=").concat(y.value),cancel_url:"http://localhost:5173/departments/".concat(x.params.id),line_items:[{price:s,quantity:l.value}],mode:"payment",payment_method_types:["card"]},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});D.setCheckOutId(n.data.id),n.data.url&&(window.location.href=n.data.url)}catch(n){console.error("Error en el checkout",n)}},A=async s=>{try{const o=await F.post("https://api.stripe.com/v1/prices",{currency:"mxn",unit_amount:s*100,"product_data[name]":"Gold Plan"},{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer sk_test_IKYCHOAmUhC7IPTdaoVtO58D"}});B.value=o.data.id}catch(o){console.error("No pudimos agregar el precio",o)}},q=()=>{if(u.value=N.value,_.value=u.value.price,l.value=V(i.value.date_out,i.value.date_in),l.value){y.value=_.value*l.value*1.1;const s=_.value*1.1;A(parseInt(s.toFixed(2)))}},z=async()=>{if(T.departmentInfo&&(u.value=T.departmentInfo,_.value=T.departmentInfo.price,l.value=V(i.value.date_out,i.value.date_in),l.value)){y.value=_.value*l.value*1.1;const s=_.value*1.1;A(parseInt(s.toFixed(2)))}};return R.value&&Y!=null,pe(()=>{x.fullPath.includes("reservation")&&x.query.department?q():z()}),me(()=>[N.value,G.value,i.value.date_in,i.value.date_out],s=>{z(),q()}),(s,o)=>(p(),fe(ve,null,[a(e(ie),{class:"ion-padding-vertical w-full card-content"},{default:t(()=>[a(e(ne),null,{default:t(()=>[a(e(oe),{class:"ml-3"},{default:t(()=>{var n;return[r(v((n=u.value)==null?void 0:n.name),1)]}),_:1}),a(e(se),{class:"ml-3"},{default:t(()=>{var n;return[r("$"+v((n=u.value)==null?void 0:n.price)+" MXN p/noche",1)]}),_:1}),a(e(f)),a(e(H),{class:"p-0"},{default:t(()=>[a(e(f),null,{default:t(()=>[a(e(L),null,{default:t(()=>[r("Día de entrada")]),_:1}),a(e(P),{datetime:"datetimeIn"}),a(e(X),{"keep-contents-mounted":!0},{default:t(()=>[a(e(j),{id:"datetimeIn","is-date-enabled":K,presentation:"date",value:i.value.date_in,"format-options":S.value,onIonChange:J},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1}),a(e(H),{class:"p-0"},{default:t(()=>[a(e(f),{lines:"inset"},{default:t(()=>[a(e(L),null,{default:t(()=>[r("Día de Salida")]),_:1}),a(e(P),{datetime:"datetimeOut"}),a(e(X),{"keep-contents-mounted":!0},{default:t(()=>[a(e(j),{id:"datetimeOut",presentation:"date",value:i.value.date_out,"format-options":S.value,onIonChange:W},null,8,["value","format-options"])]),_:1})]),_:1})]),_:1})]),_:1}),I.value?k("",!0):(p(),m(e(E),{key:0,onClick:o[0]||(o[0]=n=>Q(B.value)),class:"mx-5",expand:"block"},{default:t(()=>[r(" Reservar ")]),_:1})),I.value?(p(),m(e(E),{key:1,disabled:"",expand:"block",class:"ion-margin"},{default:t(()=>[r(" Revisa las fechas ")]),_:1})):k("",!0),a(e(f),{lines:"inset"},{default:t(()=>[a(e(d),{class:"ion-padding-start"},{default:t(()=>[ge]),_:1})]),_:1}),a(e(f),{lines:"inset"},{default:t(()=>[a(e(h),{size:"6"},{default:t(()=>[a(e(d),{class:"ion-padding-start ion-no-margin text-base"},{default:t(()=>{var n;return[w("u",null,"$"+v((n=u.value)==null?void 0:n.price)+" MXN x "+v(l.value)+" noches",1)]}),_:1})]),_:1}),a(e(h),{size:"6"},{default:t(()=>[a(e(O),{class:"ion-justify-content-end ion-margin-end"},{default:t(()=>{var n;return[(n=u.value)!=null&&n.price&&l.value?(p(),m(e(d),{key:0,class:"ion-no-margin text-base"},{default:t(()=>{var C;return[r("$"+v(((C=u.value)==null?void 0:C.price)*l.value)+" MXN",1)]}),_:1})):I.value?k("",!0):(p(),m(e(d),{key:1},{default:t(()=>[r("???")]),_:1}))]}),_:1})]),_:1})]),_:1}),a(e(f),{lines:"inset"},{default:t(()=>[a(e(h),null,{default:t(()=>[a(e(d),{class:"ion-padding-start ion-no-margin text-lg"},{default:t(()=>[ye,a(e(le),{icon:e(te)},null,8,["icon"])]),_:1})]),_:1}),a(e(h),null,{default:t(()=>[a(e(O),{class:"ion-justify-content-end ion-margin-end"},{default:t(()=>[u.value&&l.value?(p(),m(e(d),{key:0,class:"ion-no-margin text-base"},{default:t(()=>[r("$"+v(u.value.price*l.value*.1)+" MXN",1)]),_:1})):I.value?k("",!0):(p(),m(e(d),{key:1},{default:t(()=>[r("???")]),_:1}))]),_:1})]),_:1})]),_:1}),a(e(f),{lines:"inset"},{default:t(()=>[a(e(h),null,{default:t(()=>[a(e(d),{class:"ion-padding-start"},{default:t(()=>[De]),_:1})]),_:1}),a(e(h),null,{default:t(()=>[a(e(O),{class:"ion-justify-content-end ion-margin-end"},{default:t(()=>[y.value?(p(),m(e(d),{key:0,class:"ion-padding-start text-base"},{default:t(()=>[w("b",null,"$"+v(y.value.toFixed(2)),1)]),_:1})):I.value?k("",!0):(p(),m(e(d),{key:1},{default:t(()=>[r("???")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),a(e(ue),{"is-open":$.value,position:"middle",message:"Agrega los días que quieres quedarte","position-anchor":"footer",duration:2e3,onDidDismiss:o[1]||(o[1]=n=>$.value=!1)},null,8,["is-open"])],64))}}),Me=he(Ce,[["__scopeId","data-v-0fc73287"]]);export{Me as R};
